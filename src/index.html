<html>

<head>
    <title> Cyberhawk 2015</title>
</head>
<!-- body -->

<body>
</body>
<!-- script -->
<script src="js/three.js"></script>
<script src="js/three.css3drenderer.js"></script>
<!--script src="js/tweenjs.js"></script-->
<script src="js/jquery.js"></script>
<script src="js/tween-lib.js"></script>
<script src="js/index.js"></script>
<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/polymer/polymer.html">
<script>
function popup_toast(string) {
    toast = document.querySelector("#toast");
    Polymer.dom(toastElement).textContent = string;
    toast.show();
}


var REQUESTS = {
    //calls callback with true for successful login, false for unsucessful login
    login: function(username, password, callback) {
        setTimeout(function() {
            if (username == "admin") {
                callback(true);
            } else {
                callback(false);
            }
        }, 500);
    },

    logout: function() {

    },

    answer: function(answer, callback) {
        setTimeout(function() {
            if (answer == "answer") {
                callback(true);
            } else {
                callback(false);
            }
        }, 500);
    },

    next_question: function(callback) {
        setTimeout(function() {
            questions = ["what is the sun?", "what is the moon?", "what are the stars"];
            callback(questions[Math.floor(Math.random() * questions.length)]);
        }, 500);
    }

}

var STATE = {
    questionNumber: 1,
    top_card: null,
    showing_hints: true,

    switch_card_anim: function(new_top) {
        var old_top = this.top_card;
        new_top.position.y = -1000;
        new_top.position.z = 0;

        var hide_tween = new TWEEN.Tween(old_top.position)
            .to({
                z: -100
            }, 500)
            .easing(TWEEN.Easing.Cubic.In);

        var show_question_tween = new TWEEN.Tween(new_top.position).to({
            y: 0
        }).easing(TWEEN.Easing.Cubic.Out);;

        hide_tween.start();
        show_question_tween.delay(100).start();
        this.top_card = new_top;
    },

    try_login: function() {
        this.login_card_elem.login_button.disabled = true;
        this.profile_card_elem.logout_button.disabled = false;
        this.login_card_elem.login_progress.indeterminate = true;
    },

    error_login: function() {
        this.login_card_elem.login_button.disabled = false;
        this.login_card_elem.login_progress.indeterminate = false;
        this.login_card_elem.login_progress.value = 0;

        console.log(document.querySelector('#toast'));
        popup_toast("Wrong username or password");
    },

    try_answer: function(submit_button, answer_progress) {
        submit_button.disabled = true;
        answer_progress.indeterminate = true;
    },

    error_answer: function(submit_button, answer_progress) {
        submit_button.disabled = false;
        answer_progress.indeterminate = false;

        popup_toast("Wrong answer. Please try again");
    },

    hide_card: function(card_obj, delay) {
        delay = delay == undefined ? 0 : delay;
        var hide_tween = new TWEEN.Tween(card_obj.position).to({
            y: -1000
        }).easing(TWEEN.Easing.Cubic.In);
        hide_tween.delay(delay).start();

    },

    show_card: function(card_obj, delay) {
        var show_tween = new TWEEN.Tween(card_obj.position).to({
            y: 0
        }).easing(TWEEN.Easing.Cubic.Out);;
        show_tween.delay(delay).start();
    },

    show_profile: function() {
        this.show_card(this.profile_card_obj, 200);
    },

    hide_profile: function() {
        this.hide_card(this.profile_card_obj, 200)
    },

    show_hints: function() {
        this.show_card(this.hints_card_obj, 300);
    },

    hide_hints: function() {
        this.hide_card(this.hints_card_obj, 300);
        this.hide_card(this.rules_card_obj, 300);
    },


    logout: function() {
        //logout_button.disabled = true;
        this.profile_card_elem.logout_button.disabled = true;
        this.login_card_elem.login_button.disabled = false;
    }

}


function create_css3d_obj(elem) {
    var cssObject = new THREE.CSS3DObject(elem);
    return cssObject;
}

function attach_ripple(elem) {
    var ripple = document.createElement("paper-ripple");
    elem.appendChild(ripple);
}

function create_input(label) {
    var input = document.createElement("paper-input");
    input.setAttribute("label", label);
    return input;
}

function create_button(label) {
    var button = document.createElement("paper-button");
    //button.innerHTML = "Login";
    Polymer.dom(button).textContent = label;
    //button.setAttribute("raised", "true");
    return button;
}


function create_header(type, label) {
    var header = document.createElement(type);
    header.innerHTML = label;
    return header;
}

function create_progress() {
    var spinner = document.createElement("paper-progress");
    return spinner;
}

function create_question_card(content) {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("elevation", "5");
    //attach_ripple(card_elem);
    var question_progress = create_progress();
    card_elem.appendChild(question_progress);


    var question_container = document.createElement("div");
    question_container.setAttribute("class", "question-container");
    card_elem.appendChild(question_container);

    var question_title = create_header("h3", "Question " + STATE.questionNumber);
    question_container.appendChild(question_title);

    var content_region = document.createElement("div");
    content_region.setAttribute("class", "content-container");
    content_region.innerHTML = content;
    question_container.appendChild(content_region);

    var submit_form = document.createElement("form");
    submit_form.action = "#";
    question_container.appendChild(submit_form);

    var answer_input = create_input("Answer");
    submit_form.appendChild(answer_input);

    var submit_button = create_button("Submit")
    submit_form.appendChild(submit_button);


    submit_form.onsubmit = submit_button.onclick = function() {
        STATE.try_answer(submit_button, question_progress);
        REQUESTS.answer(answer_input.value, function(correct) {
            if (correct) {
                REQUESTS.next_question(function(question) {
                    var question_card = create_question_card(question);
                    STATE.switch_card_anim(question_card);
                });
            } else {
                STATE.error_answer(submit_button, question_progress);
            }
        });
    }

    var hidden_submit = document.createElement("input");
    hidden_submit.type = "submit";
    hidden_submit.hidden = true;
    submit_form.appendChild(hidden_submit);

    var card_obj = create_css3d_obj(card_elem);
    cssScene.add(card_obj);

    //store it in STATE
    STATE.questioncard_obj = card_obj;
    STATE.questioncard_elem = card_elem;

    return card_obj;

}

function create_login_card(cssScene) {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");

    var login_progress = create_progress();
    card_elem.appendChild(login_progress);
    card_elem.login_progress = login_progress;


    var login_form = document.createElement("form");
    login_form.action = "#";
    login_form.setAttribute("class", "login-container");
    card_elem.appendChild(login_form)

    var header = create_header("h1", "Cyberhawk");
    login_form.appendChild(header);

    var uname_input = create_input("username");
    login_form.appendChild(uname_input);

    var password_input = create_input("password");
    password_input.setAttribute("type", "password")
    login_form.appendChild(password_input);

    var hidden_submit = document.createElement("input");
    hidden_submit.type = "submit";
    hidden_submit.hidden = true;
    login_form.appendChild(hidden_submit);

    var login_button = create_button("Login");
    login_form.appendChild(login_button);
    card_elem.login_button = login_button;


    //login onclick
    login_form.onsubmit = login_button.onclick = function() {
        STATE.try_login();

        REQUESTS.login(uname_input.value, password_input.value, function(success) {
            if (success) {
                REQUESTS.next_question(function(question) {
                    var question_card = create_question_card(question);
                    console.log(question_card);
                    STATE.switch_card_anim(question_card);
                    STATE.show_profile();

                    STATE.show_hints();
                    //STATE.hide_card(STATE.rules_card_obj);
                });
            } else {
                STATE.error_login();
            }
        });
    }

    var card_obj = create_css3d_obj(card_elem);
    cssScene.add(card_obj);

    //store it in STATE
    STATE.login_card_obj = card_obj;
    STATE.login_card_elem = card_elem;

    STATE.top_card = card_obj;

    return card_obj;
}

function create_profile_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 22%; height: 80%;");
    attach_ripple(card_elem);

    var profile_container = document.createElement("div");
    profile_container.setAttribute("class", "profile-container");
    card_elem.appendChild(profile_container);


    var profileName = create_header("h3", "Dummy Name");
    profileName.setAttribute("class", "profile-name");
    profile_container.appendChild(profileName);

    var leadersContainer = document.createElement("div");
    profile_container.appendChild(leadersContainer);

    var leadersHeading = create_header("h5", "Leaders");
    leadersContainer.appendChild(leadersHeading)


    var logout_button = create_button("Logout");
    profile_container.appendChild(logout_button);
    card_elem.logout_button = logout_button;

    logout_button.onclick = function() {
        REQUESTS.logout();
        STATE.logout();
        STATE.switch_card_anim(STATE.login_card_obj);
        STATE.hide_profile();

        STATE.hide_card(STATE.hints_card_obj);
        STATE.hide_card(STATE.rules_card_obj);
    }

    var card_obj = create_css3d_obj(card_elem);
    cssScene.add(card_obj);

    STATE.profile_card_obj = card_obj;
    STATE.profile_card_elem = card_elem;

    card_obj.position.y = -1000;

    return card_obj;
}

function create_hints_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 25%; height: 80%");

    $(card_elem).click(function() {
        console.log("hints clicked");
        STATE.hide_card(STATE.hints_card_obj);
        STATE.show_card(STATE.rules_card_obj, 1000);
    });

    attach_ripple(card_elem);

    var hints_container = document.createElement("div");
    hints_container.setAttribute("class", "hints-container");
    card_elem.appendChild(hints_container);


    var hints_header = create_header("h3", "Hints");
    hints_container.appendChild(hints_header);

    var hints_container = document.createElement("div");
    hints_container.setAttribute("class", "hints-container");

    var card_obj = create_css3d_obj(card_elem);
    card_obj.position.y = -1000;

    cssScene.add(card_obj);

    STATE.hints_card_obj = card_obj;
    STATE.hints_card_elem = card_elem;
}

function create_rules_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 25%; height: 80%");

    $(card_elem).click(function() {
        console.log("rules clicked");
        STATE.hide_card(STATE.rules_card_obj);
        STATE.show_card(STATE.hints_card_obj, 1000);
    });
    attach_ripple(card_elem);

    var rules_container = document.createElement("div");
    rules_container.setAttribute("class", "rules-container");
    card_elem.appendChild(rules_container);

    var rules_header = create_header("h3", "Rules");
    rules_container.appendChild(rules_header);

    var card_obj = create_css3d_obj(card_elem);
    card_obj.position.z = -2;
    card_obj.position.y = -1000;

    cssScene.add(card_obj);

    STATE.rules_card_obj = card_obj;
    STATE.rules_card_elem = card_elem;
}

//SETUP SCENE
var cssScene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.z = 500;
var cssRenderer = new THREE.CSS3DRenderer();

cssRenderer.setSize(window.innerWidth, window.innerHeight);
cssRenderer.domElement.style.position = 'absolute';
cssRenderer.domElement.style.top = 0;
cssRenderer.domElement.style.background = '#161928';

document.body.appendChild(cssRenderer.domElement);

//SETUP TOAST
toastElement = document.createElement("paper-toast");
toastElement.setAttribute("z-index", "9999");
toastElement.setAttribute("id", "toast");
toastElement.setAttribute("duration", "5000");

document.body.appendChild(toastElement);


create_login_card(cssScene);
create_profile_card(cssScene);
create_hints_card(cssScene);
create_rules_card(cssScene);

var render = function(time) {
    requestAnimationFrame(render);
    //cssObject.rotation.x += 0.01;
    cssRenderer.render(cssScene, camera);
    TWEEN.update(time);
};

//onresize handler
window.onresize = function() {
    camera.aspectRatio = window.innerWidth / window.innerHeight;
    cssRenderer.setSize(window.innerWidth, window.innerHeight);

    STATE.profile_card_obj.position.x = window.innerWidth * 0.35;
    STATE.hints_card_obj.position.x = -window.innerWidth * 0.35;
    STATE.rules_card_obj.position.x = -window.innerWidth * 0.35;
    console.log("resized!");
};
window.onresize();

render();
</script>
<!-- style -->
<style type="text/css">
body {
    margin: 0;
    font-family: "Meslo LG S DZ for Powerline" !important;
    font-weight: 200;
}

canvas {
    width: 100%;
    height: 100%;
}

.card {
    width: 40%;
    height: 90%;
    background-color: #24263D;
    color: #dfdfdf;
}

paper-progress {
    width: 100%;
}

#active-progress.paper-progress,
#indeterminateSplitter,
.indeterminate {
    background-color: #6A7DD3 !important;
}


/* login */

.login-container,
.question-container {
    padding-top: 20%;
    padding-left: 20%;
    padding-right: 20%;
}

.login-container paper-button {
    margin-top: 10%;
}

paper-button {
    background: #5ECBEE;
    color: #dfdfdf;
    padding-left: 10%;
    padding-right: 10%;
}

.paper-input,
label {
    color: #bfbfbf !important;
}

.focused-line {
    background: #bfbfbf !important;
}

paper-input-container input,
paper-input-container label {
    font-family: "Meslo LG S DZ for Powerline" !important;
    color: #dfdfdf;
    --paper-input-container-focus-color: #dfdfdf;
}


/* question */

.question-container h3 {}

.question-container .content-container {
    margin-top: 30%;
    margin-bottom: 30%;
}

.question-container paper-input {
    margin-bottom: 10%;
}

.question-container paper-button {
    margin-top: 20%;
}


/*profile*/

.profile-container {
    padding-top: 10%;
    padding-bottom: 30%;
    padding-left: 10%;
    padding-right: 10%;
}

.profile-container paper-button {
    margin-top: 20%;
}


/*
   hints
 */

.hints-container,
.rules-container {
    padding-top: 10%;
    padding-bottom: 30%;
    padding-left: 10%;
    padding-right: 10%;
}
</style>

</html>
