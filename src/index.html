<html>

<head>
    <title> Cyberhawk 2015</title>
    <meta content='width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;' name='viewport' />
    <meta name="viewport" content="width=device-width" />
</head>
<!-- body -->

<body>
</body>
<!-- script -->
<script src="js/three.js"></script>
<script src="js/three.css3drenderer.js"></script>
<!--script src="js/tweenjs.js"></script-->
<script src="js/jquery.js"></script>
<script src="js/tween-lib.js"></script>
<script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-material/paper-material.html">
<link rel="import" href="bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="bower_components/paper-toast/paper-toast.html">
<link rel="import" href="bower_components/paper-progress/paper-progress.html">
<link rel="import" href="bower_components/polymer/polymer.html">
<script>
function popup_toast(string) {
    toast = document.querySelector("#toast");
    Polymer.dom(toastElement).textContent = string;
    toast.show();
}

function send_request_to_server(request_name, data, callback) {
    var REQUEST_URL = "http://iecsemanipal.com/cyberhawk/api";
    var API_KEY = "fUJxtW62tresIB7m";
    data["API_KEY"] = API_KEY;
    data["REQUEST"] = request_name;
    data["SECURITY"] = "OFF";

    console.log("sending request (" + request_name + ")", data);
    //onsole.log("stringified: ", jQuery.param(data))

    var requestFn = function() {
        $.ajax({
                type: "GET",
                url: REQUEST_URL,
                data: data,
            }).done(function(response) {
                response = JSON.parse(response);
                response.success = true;
                console.log("response for (" + request_name + "): ", response);

                callback && callback(response);
            })
            .fail(function(respose) {
                response = JSON.parse(response);
                response.success = false;

                console.log("response for (" + request_name + "): ", response);
                callback && callback(response);
            });
    };
    setTimeout(requestFn, 1000);
}

var REQUESTS = {
    //calls callback with true for successful login, false for unsucessful login
    login: function(email, password, callback) {
        data = {}
        data["EMAIL"] = email;
        data["PASSWORD"] = password;
        send_request_to_server("playerLogin", data, callback)
    },

    register: function(data, callback) {
        send_request_to_server("register", data, callback);

    },

    logout: function(sessionID) {
        data = {}
        data["sessionID"] = sessionID;
        send_request_to_server("playerLogout", data, function(response) {
            console.log("logged out");
        });
    },

    answer: function(sessionID, answer, callback) {
        data = {}
        data["sessionID"] = sessionID;
        data["ANSWER"] = answer;
        send_request_to_server("checkAnswer", data, callback);
    },

    get_question: function(sessionID, callback) {
        data = {}
        data["sessionID"] = sessionID;
        send_request_to_server("getQuestion", data, callback);
    },

    get_hints: function(sessionID, callback) {
        data = {
            "sessionID": sessionID
        };
        send_request_to_server("getHints", data, callback);
    },

    get_position: function(sessionID, callback) {
        data = {
            "sessionID": sessionID
        };
        send_request_to_server("getMyPosition", data, callback);
    },

    get_player_info: function(sessionID, callback) {
        data = {
            "sessionID": sessionID
        };
        send_request_to_server("getPlayer", data, callback);
    }


};

var GLOBALS = {
    camera: null,
    cssRenderer: null,
    cssScene: null,
    mousePos: null,

};
var STATE = {
    questionNumber: 1,
    top_card: null,
    showing_hints: true,
    sessionID: null,


    switch_card_anim: function(new_top) {
        var old_top = this.top_card;
        new_top.position.y = -1000;
        new_top.position.z = 0;

        var hide_tween = new TWEEN.Tween(old_top.position)
            .to({
                z: -100,
                y: -2000,
            }, 500)
            .easing(TWEEN.Easing.Cubic.In);

        var show_tween = new TWEEN.Tween(new_top.position).to({
            y: 0
        }).easing(TWEEN.Easing.Cubic.Out);;

        hide_tween.start();
        show_tween.delay(100).start();
        this.top_card = new_top;
    },

    try_login: function() {
        this.login_card_elem.login_button.disabled = true;
        this.login_card_elem.goto_register_button.disabled = true;
        this.profile_card_elem.logout_button.disabled = false;
        this.login_card_elem.login_progress.indeterminate = true;
    },

    error_login: function(error_message) {
        this.login_card_elem.login_button.disabled = false;
        this.login_card_elem.goto_register_button.disabled = false;
        this.login_card_elem.login_progress.indeterminate = false;
        this.login_card_elem.login_progress.value = 0;

        popup_toast(error_message);
    },

    success_login: function() {
        this.login_card_elem.login_button.disabled = false;
        this.login_card_elem.goto_register_button.disabled = false;
        this.login_card_elem.login_progress.indeterminate = false;
        this.login_card_elem.login_progress.value = 0;

        //enable logout buttons
        this.profile_card_elem.logout_button.disabled = false;
        popup_toast("successfully logged in");
    },

    try_register: function() {
        this.register_card_elem.register_button.disabled = true;
        this.register_card_elem.go_to_login_button.disabled = true;
        this.register_card_elem.register_progress.indeterminate = true;

    },

    error_register: function(error_message) {
        this.register_card_elem.register_button.disabled = false;
        this.register_card_elem.go_to_login_button.disabled = false;
        this.register_card_elem.register_progress.indeterminate = false;
        popup_toast(error_message)
    },
    success_register: function() {
        popup_toast("registered successfully");
        this.register_card_elem.register_button.disabled = false;
        this.register_card_elem.go_to_login_button.disabled = false;
        this.register_card_elem.register_progress.indeterminate = false;

    },

    try_answer: function(submit_button, answer_progress) {
        submit_button.disabled = true;
        answer_progress.indeterminate = true;
    },

    error_answer: function(submit_button, answer_progress) {
        submit_button.disabled = false;
        answer_progress.indeterminate = false;

        popup_toast("Wrong answer. Please try again");
    },

    hide_card: function(card_obj, delay) {
        delay = delay == undefined ? 0 : delay;
        var hide_tween = new TWEEN.Tween(card_obj.position).to({
            y: -1000
        }).easing(TWEEN.Easing.Cubic.In);
        hide_tween.delay(delay).start();

    },

    show_card: function(card_obj, delay) {
        var show_tween = new TWEEN.Tween(card_obj.position).to({
            y: 0
        }).easing(TWEEN.Easing.Cubic.Out);;
        show_tween.delay(delay).start();
    },

    show_profile: function() {
        this.show_card(this.profile_card_obj, 200);
    },

    hide_profile: function() {
        this.hide_card(this.profile_card_obj, 200)
    },

    update_profile: function() {
        REQUESTS.get_position(STATE.sessionID, function(response) {
            STATE.profile_card_elem.leadersTextRegion.innerHTML = response["data"]["leaders"];
            STATE.profile_card_elem.onParTextRegion.innerHTML = response["data"]["same"];
            STATE.profile_card_elem.trailersTextRegion.innerHTML = response["data"]["trailers"];
        });

        REQUESTS.get_player_info(STATE.sessionID, function(response) {
            STATE.profile_card_elem.profileNameTextRegion.innerHTML = response["data"]["NAME"];
            STATE.questionNumber = response["data"]["LEVEL"];
        });
    },
    show_hints: function() {
        this.show_card(this.hints_card_obj, 300);
    },

    update_hints: function() {
        REQUESTS.get_hints(STATE.sessionID, function(response) {
            for (var i = 0; i < response["data"].length; i++) {
                var hint = response["data"][i];
                console.log("~~hints: ", hint);
                STATE.hints_card_elem.hintTextRegion[i].innerHTML += hint;
            };

        });
    },

    hide_hints: function() {
        this.hide_card(this.hints_card_obj, 300);
        this.hide_card(this.rules_card_obj, 300);
    },


    logout: function() {
        //logout_button.disabled = true;
        this.profile_card_elem.logout_button.disabled = true;
        this.login_card_elem.login_button.disabled = false;
    }

}


function create_css3d_obj(elem) {
    var cssObject = new THREE.CSS3DObject(elem);
    return cssObject;
}

function attach_ripple(elem) {
    var ripple = document.createElement("paper-ripple");
    elem.appendChild(ripple);
}

function create_input(label) {
    var input = document.createElement("paper-input");
    input.setAttribute("label", label);
    return input;
}

function create_button(label) {
    var button = document.createElement("paper-button");
    //button.innerHTML = "Login";
    Polymer.dom(button).textContent = label;
    //button.setAttribute("raised", "true");
    return button;
}


function create_header(type, label) {
    var header = document.createElement(type);
    header.innerHTML = label;
    return header;
}

function create_progress() {
    var spinner = document.createElement("paper-progress");
    return spinner;
}

function create_question_card(content) {
    var card_paper = document.createElement("paper-material");
    var card_elem = document.createElement("div");
    card_elem.setAttribute("class", "card");
    card_paper.appendChild(card_elem);

    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("elevation", "5");
    attach_ripple(card_elem);
    var question_progress = create_progress();
    card_elem.appendChild(question_progress);


    var question_container = document.createElement("div");
    question_container.setAttribute("class", "question-container");
    card_elem.appendChild(question_container);

    var question_title = create_header("h3", "Level " + STATE.questionNumber);
    question_container.appendChild(question_title);

    REQUESTS.get_player_info(STATE.sessionID, function(response) {
        question_title.innerHTML = "Level " + response["data"]["LEVEL"];
    })


    var content_region = document.createElement("div");
    content_region.setAttribute("class", "content-container");
    content_region.innerHTML = content;
    question_container.appendChild(content_region);

    var submit_form = document.createElement("form");
    submit_form.action = "#";
    question_container.appendChild(submit_form);

    var answer_input = create_input("Answer");
    submit_form.appendChild(answer_input);

    var submit_button = create_button("Submit")
    submit_form.appendChild(submit_button);


    submit_form.onsubmit = submit_button.onclick = function(e) {
        e.preventDefault();

        STATE.try_answer(submit_button, question_progress);
        //send answer request
        REQUESTS.answer(STATE.sessionID, answer_input.value, function(response) {
            var correct = response["data"] === true;

            if (correct) {
                REQUESTS.get_question(STATE.sessionID, function(response) {
                    var question = response["data"]["questionText"];
                    var question_card = create_question_card(question);
                    STATE.switch_card_anim(question_card);
                    STATE.update_hints();
                });
            } else {
                STATE.error_answer(submit_button, question_progress);
            }
        });
    }

    var hidden_submit = document.createElement("input");
    hidden_submit.type = "submit";
    hidden_submit.hidden = true;
    submit_form.appendChild(hidden_submit);

    var card_obj = create_css3d_obj(card_elem);
    GLOBALS.cssScene.add(card_obj);

    //store it in STATE
    STATE.questioncard_obj = card_obj;
    STATE.questioncard_elem = card_elem;

    return card_obj;

}

function create_login_card(cssScene) {
    var card_paper = document.createElement("paper-material");
    var card_elem = document.createElement("div");
    card_elem.setAttribute("class", "card");
    card_paper.appendChild(card_elem);
    attach_ripple(card_elem);

    var login_progress = create_progress();
    card_elem.appendChild(login_progress);
    card_elem.login_progress = login_progress;


    var login_form = document.createElement("form");
    login_form.action = "#";
    login_form.setAttribute("class", "login-container");
    card_elem.appendChild(login_form)

    var header = create_header("h1", "Cyberhawk");
    login_form.appendChild(header);

    var email_input = create_input("E-mail id");
    login_form.appendChild(email_input);

    var password_input = create_input("password");
    password_input.setAttribute("type", "password")
    login_form.appendChild(password_input);


    var hidden_submit = document.createElement("input");
    hidden_submit.type = "submit";
    hidden_submit.hidden = true;
    login_form.appendChild(hidden_submit);

    var login_button = create_button("Login");
    login_form.appendChild(login_button);
    card_elem.login_button = login_button;

    var goto_register_button = create_button("Register now");
    login_form.appendChild(goto_register_button);
    card_elem.goto_register_button = goto_register_button;


    goto_register_button.onclick = function() {
        STATE.switch_card_anim(STATE.register_card_obj);
    };
    //login onclick
    login_form.onsubmit = login_button.onclick = function(e) {
        e.preventDefault();
        STATE.try_login();

        if (email_input.value === "") {
            STATE.error_login("enter E-mail id");
            return;
        };
        if (password_input.value === "") {
            STATE.error_login("enter password");
        };
        REQUESTS.login(email_input.value, password_input.value, function(response) {

            if (response["data"] === "PARAMS-INVALID" ||
                response["data"] === "LOGIN-INVALID" ||
                response["responseType"] === "apiError") {
                STATE.error_login("wrong username or password");

            } else {
                console.log("response from login: ", response);
                STATE.sessionID = response["data"]["sessionID"];
                console.log("sessionID: ", STATE.sessionID);

                REQUESTS.get_question(STATE.sessionID, function(response) {
                    STATE.success_login();
                    //load the question
                    var question = response["data"]["questionText"];
                    var question_card = create_question_card(question);
                    //switch
                    STATE.switch_card_anim(question_card);
                    STATE.show_profile();
                    STATE.update_profile();
                    STATE.show_hints();
                    STATE.update_hints();

                });

            }
        });
    }

    var card_obj = create_css3d_obj(card_elem);
    GLOBALS.cssScene.add(card_obj);

    //store it in STATE
    STATE.login_card_obj = card_obj;
    STATE.login_card_elem = card_elem;

    card_obj.position.y = -1000;


    return card_obj;
}

function create_profile_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 22%; height: 80%;");
    attach_ripple(card_elem);

    var profile_container = document.createElement("div");
    profile_container.setAttribute("class", "profile-container");
    card_elem.appendChild(profile_container);


    var profileNameTextRegion = create_header("h3", "Dummy Name");
    profileNameTextRegion.setAttribute("class", "profile-name");
    profile_container.appendChild(profileNameTextRegion);
    card_elem.profileNameTextRegion = profileNameTextRegion;

    var positionsContainer = document.createElement("div");
    profile_container.appendChild(positionsContainer);

    //leaders
    var leadersHeader = create_header("h4", "Leaders");
    leadersHeader.setAttribute("class", "profile-header");
    positionsContainer.appendChild(leadersHeader)

    var leadersTextRegion = create_header("h5", "qwer");
    positionsContainer.appendChild(leadersTextRegion);
    card_elem.leadersTextRegion = leadersTextRegion;

    //onpar
    var onParHeader = create_header("h4", "On Par");
    onParHeader.setAttribute("class", "profile-header");
    positionsContainer.appendChild(onParHeader);

    var onParTextRegion = create_header("h5", "qwer");
    positionsContainer.appendChild(onParTextRegion);
    card_elem.onParTextRegion = onParTextRegion;


    //lagging
    var trailersHeader = create_header("h4", "Trailers");
    trailersHeader.setAttribute("class", "profile-header");
    positionsContainer.appendChild(trailersHeader);

    var trailersTextRegion = create_header("h5", "qwer");
    positionsContainer.appendChild(trailersTextRegion);
    card_elem.trailersTextRegion = trailersTextRegion;



    var logout_button = create_button("Logout");
    profile_container.appendChild(logout_button);
    card_elem.logout_button = logout_button;

    logout_button.onclick = function() {
        REQUESTS.logout(STATE.sessionID);
        STATE.logout();
        STATE.switch_card_anim(STATE.login_card_obj);
        STATE.hide_profile();

        STATE.hide_card(STATE.hints_card_obj);
        STATE.hide_card(STATE.rules_card_obj);
    }

    var card_obj = create_css3d_obj(card_elem);
    GLOBALS.cssScene.add(card_obj);

    STATE.profile_card_obj = card_obj;
    STATE.profile_card_elem = card_elem;

    card_obj.position.y = -1000;

    return card_obj;
}

function create_hints_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 25%; height: 80%");

    $(card_elem).click(function() {
        console.log("hints clicked");
        STATE.hide_card(STATE.hints_card_obj);
        STATE.show_card(STATE.rules_card_obj, 1000);
    });

    attach_ripple(card_elem);



    var hints_container = document.createElement("div");
    hints_container.setAttribute("class", "hints-container");
    card_elem.appendChild(hints_container);
    card_elem.hints_container = hints_container;

    var hints_header = create_header("h3", "Hints");
    hints_container.appendChild(hints_header);

    card_elem.hintTextRegion = [];

    for (var i = 0; i < 3; i++) {
        var hintRegion = document.createElement("div");
        hintRegion.setAttribute("class", "hint-region");
        hints_container.appendChild(hintRegion);
        card_elem.hintTextRegion.push(hintRegion);
    }



    var card_obj = create_css3d_obj(card_elem);
    card_obj.position.y = -1000;

    GLOBALS.cssScene.add(card_obj);

    STATE.hints_card_obj = card_obj;
    STATE.hints_card_elem = card_elem;
}

function create_rules_card() {
    var card_elem = document.createElement("paper-material");
    card_elem.setAttribute("class", "card");
    card_elem.setAttribute("style", "width: 25%; height: 80%");

    $(card_elem).click(function() {
        console.log("rules clicked");
        STATE.hide_card(STATE.rules_card_obj);
        STATE.show_card(STATE.hints_card_obj, 1000);
    });
    attach_ripple(card_elem);

    var rules_container = document.createElement("div");
    rules_container.setAttribute("class", "rules-container");
    card_elem.appendChild(rules_container);

    var rules_header = create_header("h3", "Rules");
    rules_container.appendChild(rules_header);

    var card_obj = create_css3d_obj(card_elem);
    card_obj.position.z = -2;
    card_obj.position.y = -1000;

    GLOBALS.cssScene.add(card_obj);

    STATE.rules_card_obj = card_obj;
    STATE.rules_card_elem = card_elem;
}

function create_register_card() {
    var card_paper = document.createElement("paper-card");
    card_paper.setAttribute("elevation", "5");
    card_paper.setAttribute("animatedShadow", "true");


    var card_elem = document.createElement("div");
    card_elem.setAttribute("class", "card");
    card_paper.appendChild(card_elem);
    attach_ripple(card_elem);

    var register_progress = create_progress();
    card_elem.appendChild(register_progress);
    card_elem.register_progress = register_progress;


    var register_form = document.createElement("form");
    register_form.action = "#";
    register_form.setAttribute("class", "register-container");
    card_elem.appendChild(register_form)

    var header = create_header("h1", "Register");
    register_form.appendChild(header);


    var name_input = create_input("name");
    register_form.appendChild(name_input);



    var password_input = create_input("password");
    password_input.setAttribute("type", "password")
    register_form.appendChild(password_input);

    var password_resubmit_input = create_input("retype password");
    password_resubmit_input.setAttribute("type", "password")
    register_form.appendChild(password_resubmit_input);


    var email_input = create_input("E-mail");
    register_form.appendChild(email_input);


    var phone_input = create_input("Phone number");
    register_form.appendChild(phone_input);


    var college_input = create_input("College");
    register_form.appendChild(college_input);

    var hidden_submit = document.createElement("input");
    hidden_submit.type = "submit";
    hidden_submit.hidden = true;
    register_form.appendChild(hidden_submit);

    var register_button = create_button("Register");
    register_button.setAttribute("class", "spaced-button");
    register_form.appendChild(register_button);
    card_elem.register_button = register_button;


    var go_to_login_button = create_button("Go to Login");
    register_form.appendChild(go_to_login_button);
    card_elem.go_to_login_button = go_to_login_button;

    go_to_login_button.onclick = function() {
        STATE.switch_card_anim(STATE.login_card_obj);
    };

    //login onclick
    register_form.onsubmit = register_button.onclick = function(e) {
        e.preventDefault();

        STATE.try_register();

        data = {};
        data["NAME"] = name_input.value;
        data["EMAIL"] = email_input.value;
        data["PASSWORD"] = password_input.value;
        data["COLLEGE"] = college_input.value;
        data["PHONE"] = phone_input.value;

        if (data["NAME"] === "") {
            STATE.error_register("enter username");
            return;
        };

        if (data["PASSWORD"] === "") {
            STATE.error_register("enter password");
            return;
        };
        var resubmit_password = password_resubmit_input.value;
        if (resubmit_password === "") {
            STATE.error_register("enter retyped password");
            return;

        }
        var simple_email_regex = /\S+@\S+\.\S+/;
        if (!simple_email_regex.test(data["EMAIL"])) {
            STATE.error_register("enter valid E-mail id");
        };

        if (data["PASSWORD"] !== resubmit_password) {
            STATE.error_register("passwords do not match");
            return;
        }
        if (data["PHONE"] === "") {
            STATE.error_register("enter the phone number");
            return;
        }
        if (data["COLLEGE"] === "") {
            STATE.error_register("enter college");
            return;
        };



        REQUESTS.register(data, function(response) {
            if (response["data"] === "PARAMS-INVALID") {
                STATE.error_register("invalid register info");


            } else if (response["data"] === "USER-EXISTS") {
                STATE.error_register("user already exists");
            } else if (response["data"] === "") {
                console.log("registered");
                STATE.success_register();
                STATE.switch_card_anim(STATE.login_card_obj);
            }
        });
    }

    var card_obj = create_css3d_obj(card_elem);
    GLOBALS.cssScene.add(card_obj);

    //store it in STATE
    STATE.register_card_obj = card_obj;
    STATE.register_card_elem = card_elem;

    STATE.top_card = card_obj;

    return card_obj;
}

function init() {
    //SETUP SCENE
    var cssScene = new THREE.Scene();
    GLOBALS.cssScene = cssScene;

    console.log("inner width: ", window.innerWidth, "inner height: ", window.innerHeight);


    var camera = null;
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

    GLOBALS.camera = camera;

    camera.position.z = 500;
    var cssRenderer = new THREE.CSS3DRenderer();
    GLOBALS.cssRenderer = cssRenderer;

    cssRenderer.setSize(window.innerWidth, window.innerHeight);
    cssRenderer.domElement.style.position = 'absolute';
    cssRenderer.domElement.style.top = 0;
    //cssRenderer.domElement.style.background = '#161928';
    cssRenderer.domElement.style.background = '#EFEFEF';

    document.body.appendChild(cssRenderer.domElement);

    //SETUP TOAST
    toastElement = document.createElement("paper-toast");
    toastElement.setAttribute("z-index", "9999");
    toastElement.setAttribute("id", "toast");
    toastElement.setAttribute("duration", "5000");

    document.body.appendChild(toastElement);


    create_register_card(cssScene);
    create_login_card(cssScene);
    create_profile_card(cssScene);
    create_hints_card(cssScene);
    create_rules_card(cssScene);

    function make_register_slide_up() {
        STATE.register_card_obj.position.y = -2000;
        var slide_up_tween = new TWEEN.Tween(STATE.register_card_obj.position).to({
            y: 0
        }).easing(TWEEN.Easing.Cubic.Out);
        slide_up_tween.start();
    };
    make_register_slide_up();
};


function create_spring(initial_val) {

    function setter_fn(value) {
        this.target = value;
    }

    function getter_fn(value) {
        return this.current;
    }

    function move_by_fn(value) {
        this.target = this.current + value;
    }

    function step_fn(t) {
        dt = (t - this.t) / 1000.0;
        this.t = t;

        const step_time = 1.0 / 60.0;

        if (dt > step_time * 10) {
            dt = step_time;
        }

        while (dt > 0) {
            const m = 10;
            var x = this.current - this.target;

            var a = (-1.0 * x - 1. * this.v) * m;
            /*
            if (Math.abs(a) > 200) {
                a = 200 * (a < 0 ? -1 : 1);
            }
            */

            this.v += a * dt;
            /*
            if (Math.abs(this.v) > 400) {
                this.v = 400 * (this.v < 0 ? -1 : 1);
            }
            */

            this.current += this.v * dt + 0.5 * a * dt * dt;

            dt -= step_time;
        };
    }
    var spring_system = {
        target: initial_val,
        current: 0,
        v: 0,
        a: 0,
        t: 0,
    };

    spring_system.set = setter_fn.bind(spring_system);
    spring_system.get = getter_fn.bind(spring_system);
    spring_system.step = step_fn.bind(spring_system);
    spring_system.move_by = move_by_fn.bind(spring_system);
    return spring_system;
}

function create_mouse_position_tracker() {
    GLOBALS.mousePos = {
        x: create_spring(0),
        y: create_spring(0),
    };

    $(document).mousemove(function(event) {
        GLOBALS.mousePos.x.set(event.pageX);
        GLOBALS.mousePos.y.set(event.pageY);
    });

}

function create_gyro_position_tracker() {

    window.addEventListener("deviceorientation", function() {
        var absolute = event.absolute;
        var alpha = event.alpha;
        var x_axis = event.beta;
        var y_axis = event.gamma;

        //GLOBALS.mousePos.x.set(alpha / 5.0 * window.innerWidth);
    }, true);

    window.ondevicemotion = function(event) {
        var xVal = event.accelerationIncludingGravity.x;
        GLOBALS.mousePos.x.move_by(100 * xVal);
        //GLOBALS.mousePos.y.move_by(50 * yVal);
    }
};
var render = function(time) {
    requestAnimationFrame(render);
    const ROTATE_FACTOR = 0.25;

    GLOBALS.camera.rotation.y = -ROTATE_FACTOR * (GLOBALS.mousePos.x.get() - window.innerWidth * 0.5) / window.innerWidth;
    GLOBALS.camera.rotation.x = -ROTATE_FACTOR * (GLOBALS.mousePos.y.get() - window.innerHeight * 0.5) / window.innerHeight;

    //cssObject.rotation.x += 0.01;
    GLOBALS.cssRenderer.render(GLOBALS.cssScene, GLOBALS.camera);
    GLOBALS.mousePos.x.step(time);
    GLOBALS.mousePos.y.step(time);
    TWEEN.update(time);
};

//onresize handler
window.onresize = function() {

    GLOBALS.camera.aspectRatio = window.innerWidth / window.innerHeight;
    GLOBALS.cssRenderer.setSize(window.innerWidth, window.innerHeight);

    STATE.profile_card_obj.position.x = window.innerWidth * 0.35;
    STATE.hints_card_obj.position.x = -window.innerWidth * 0.35;
    STATE.rules_card_obj.position.x = -window.innerWidth * 0.35;
    console.log("resized!");
};

init();
create_mouse_position_tracker();
create_gyro_position_tracker();
window.onresize();
render();
</script>
<!-- style -->
<style type="text/css">
@font-face {
    font-family: 'Meslo LG S DZ';
    src: url('css/fonts/MesloLGSDZ.ttf');
    /* IE9 Compat Modes */
}

@font-face {
    font-family: 'Segoe UI';
    src: url('css/fonts/segoeui.ttf');
    font-weight: 400;
}

@font-face {
    font-family: 'Segoe UI';
    src: url('css/fonts/segoeuil.ttf');
    font-weight: 300;
}

body {
    margin: 0;
    padding: 0;
    font-family: "Meslo LG S DZ", !important;
    font-weight: 200;
    overflow: hidden;
    width: 100%;
    height: 100%;
}

h1,
h2,
h3,
h4,
h5 {
    font-family: "Segoe UI" !important;
    font-weight: 300;
}

canvas {
    /*
    min-width: 100%;
    min-height: 100%;
    */
    /* fix necessary to remove space at bottom of canvas */
    display: block;
}

.card {
    padding-top: 0em;
    padding-bottom: 2em;
    padding-left: 2em;
    padding-right: 2em;
    /*
    background-color: #24263D;
    */
    background-color: #3E7797;
    color: #dfdfdf;
}

paper-progress {
    position: absolute;
    left: 0;
    right: 0;
    width: 100%;
}

#active-progress.paper-progress,
#indeterminateSplitter,
.indeterminate {
    /*
    background-color: #6A7DD3 !important;
    */
    background-color: #F76138 !important;
}


/* login */

.register-container,
.login-container,
.question-container {
    padding-top: 20%;
    padding-left: 20%;
    padding-right: 20%;
}

.login-container paper-button {
    margin-top: 10%;
}

paper-button {
    /*
    background: #5ECBEE;
    */
    background: #EFAC49;
    color: #ffffff;
    width: 100%;
    padding-left: 10%;
    padding-right: 10%;
}

.paper-input,
label {
    font-family: "Meslo LG S DZ" !important;
    /*
    color: #bfbfbf !important;
    */
    color: #dedede !important;
}

.focused-line {
    background: #EFAC49 !important;
}

paper-input-container input,
paper-input-container label {
    font-family: "Meslo LG S DZ for Powerline" !important;
    color: #dfdfdf;
    --paper-input-container-focus-color: #dfdfdf;
}


/*register, login*/

.spaced-button {
    margin-top: 1em;
    margin-bottom: 1em;
}


/* question */

.question-container h3 {}

.question-container .content-container {
    margin-top: 30%;
    margin-bottom: 30%;
}

.question-container paper-input {
    margin-bottom: 10%;
}

.question-container paper-button {
    margin-top: 20%;
}


/*profile*/

.profile-container {
    padding-top: 10%;
    padding-bottom: 30%;
    padding-left: 10%;
    padding-right: 10%;
}

.profile-container paper-button {
    margin-top: 20%;
}

.profile-header {
    font-weight: 400;
    border-bottom: 1px solid #EFEFEF;
}


/*
   hints
 */

.hints-container,
.rules-container {
    padding-top: 10%;
    padding-bottom: 30%;
    padding-left: 10%;
    padding-right: 10%;
}

.hint-region {
    font-family: "Segoe UI" !important;
}
</style>

</html>
